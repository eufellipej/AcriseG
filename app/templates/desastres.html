<!-- desastres.html -->
{% extends 'base.html' %}
{% load static %}

{% block extra_links %}
<title>Tipos de Desastres Naturais - A Crise G</title>
<link rel="stylesheet" href="{% static 'styles/desastres.css' %}">
{% endblock %}

{% block content %}
<div class="cabecario-sessao">
    <h2>Tipos de Desastres Naturais</h2>
    <p>Explore informações sobre diferentes tipos de desastres naturais e aprenda como se preparar</p>
</div>

<!-- Filtros -->
<div class="filtro-container">
    <div class="filtro-grid">
        <div class="filtro-grupo">
            <label for="filtro-tipo">Filtrar por Tipo</label>
            <select id="filtro-tipo">
                <option value="todos">Todos os Tipos</option>
                {% for desastre in desastres %}
                <option value="{{ desastre.obj.titulo|lower }}">{{ desastre.obj.titulo }}</option>
                {% endfor %}
            </select>
        </div>
        
        <div class="filtro-grupo">
            <label for="filtro-risco">Filtrar por Risco</label>
            <select id="filtro-risco">
                <option value="todos">Todos os Riscos</option>
                <option value="extremo">Extremo</option>
                <option value="alto">Alto</option>
                <option value="medio">Médio</option>
                <option value="baixo">Baixo</option>
            </select>
        </div>
        
        <div class="filtro-grupo">
            <label for="filtro-ordem">Ordenar por</label>
            <select id="filtro-ordem">
                <option value="nome">Nome (A-Z)</option>
                <option value="risco">Nível de Risco</option>
                <option value="frequencia">Frequência</option>
            </select>
        </div>
    </div>
</div>

<!-- Estatísticas -->
<div class="estatisticas-container">
    <div class="estatistica-card">
        <div class="estatistica-valor">{{ total_desastres }}</div>
        <div class="estatistica-rotulo">Tipos de Desastres</div>
    </div>
    
    <div class="estatistica-card">
        <div class="estatistica-valor">{{ acontecimentos_recentes }}</div>
        <div class="estatistica-rotulo">Ocorrências Recentes</div>
    </div>
    
    <div class="estatistica-card">
        <div class="estatistica-valor">42%</div>
        <div class="estatistica-rotulo">Aumento na Frequência</div>
    </div>
    
    <div class="estatistica-card">
        <div class="estatistica-valor">12</div>
        <div class="estatistica-rotulo">Países Afetados</div>
    </div>
</div>

<!-- Grade de Desastres -->
<div class="grade-dissater">
    {% for desastre in desastres %}
    <div class="disaster-card" data-tipo="{{ desastre.obj.titulo|lower }}" data-risco="{{ desastre.risco }}">
        <div class="disaster-icon" style="background: linear-gradient(45deg, {{ desastre.cores.0 }}, {{ desastre.cores.1 }});">
            <i class="{{ desastre.icone }}"></i>
        </div>
        <div class="disaster-info">
            <h3>{{ desastre.obj.titulo }}</h3>
            <p>{{ desastre.obj.descricao|truncatechars:150 }}</p>
            <div class="disaster-stats">
                <span class="stat-item">
                    <i class="fas fa-exclamation-triangle"></i>
                    {{ desastre.total_riscos }} riscos
                </span>
                <span class="stat-item">
                    <i class="fas fa-calendar-alt"></i>
                    {{ desastre.total_acontecimentos }} registros
                </span>
            </div>
            <a href="{% url 'desastre' desastre.obj.id %}" class="btn btn-outline">Ver detalhes</a>
        </div>
    </div>
    {% endfor %}
</div>

<!-- Informações Adicionais -->
<div class="info-container" style="margin-top: 3rem; padding: 2rem; background: var(--secudario); border-radius: var(--raio-lg);">
    <h3 style="margin-bottom: 1.5rem; color: var(--fonte);">Sobre os Desastres Naturais</h3>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem;">
        <div class="info-card">
            <i class="fas fa-shield-alt" style="font-size: 2rem; color: var(--destaque1); margin-bottom: 1rem;"></i>
            <h4>Prevenção</h4>
            <p style="color: rgba(255,255,255,0.8);">Aprenda medidas preventivas para reduzir os impactos dos desastres naturais.</p>
        </div>
        <div class="info-card">
            <i class="fas fa-graduation-cap" style="font-size: 2rem; color: var(--destaque1); margin-bottom: 1rem;"></i>
            <h4>Educação</h4>
            <p style="color: rgba(255,255,255,0.8);">Conteúdo educativo validado por especialistas em gestão de crises.</p>
        </div>
        <div class="info-card">
            <i class="fas fa-hands-helping" style="font-size: 2rem; color: var(--destaque1); margin-bottom: 1rem;"></i>
            <h4>Preparação</h4>
            <p style="color: rgba(255,255,255,0.8);">Esteja preparado com planos de emergência e kits de sobrevivência.</p>
        </div>
    </div>
</div>

{% endblock %}

{% block extra_scripts %}
<script src="{% static 'scripts/desastres.js' %}"></script>
<script>
// Filtros interativos
document.addEventListener('DOMContentLoaded', function() {
    const filtroTipo = document.getElementById('filtro-tipo');
    const filtroRisco = document.getElementById('filtro-risco');
    const filtroOrdem = document.getElementById('filtro-ordem');
    const cards = document.querySelectorAll('.disaster-card');
    
    function filtrarDesastres() {
        const tipoSelecionado = filtroTipo.value;
        const riscoSelecionado = filtroRisco.value;
        
        cards.forEach(card => {
            const tipoCard = card.getAttribute('data-tipo');
            const riscoCard = card.getAttribute('data-risco');
            
            let mostrar = true;
            
            if (tipoSelecionado !== 'todos' && tipoSelecionado !== tipoCard) {
                mostrar = false;
            }
            
            if (riscoSelecionado !== 'todos' && riscoSelecionado !== riscoCard) {
                mostrar = false;
            }
            
            if (mostrar) {
                card.style.display = 'block';
                card.style.animation = 'fadeIn 0.5s ease forwards';
            } else {
                card.style.display = 'none';
            }
        });
    }
    
    filtroTipo.addEventListener('change', filtrarDesastres);
    filtroRisco.addEventListener('change', filtrarDesastres);
    
    // Ordenação
    filtroOrdem.addEventListener('change', function() {
        const ordem = this.value;
        const container = document.querySelector('.grade-dissater');
        const cardsArray = Array.from(cards);
        
        cardsArray.sort((a, b) => {
            const tituloA = a.querySelector('h3').textContent.toLowerCase();
            const tituloB = b.querySelector('h3').textContent.toLowerCase();
            const riscoA = a.getAttribute('data-risco');
            const riscoB = b.getAttribute('data-risco');
            
            // Mapear riscos para ordenação
            const ordemRisco = { 'extremo': 4, 'alto': 3, 'medio': 2, 'baixo': 1 };
            
            switch(ordem) {
                case 'nome':
                    return tituloA.localeCompare(tituloB);
                case 'risco':
                    return ordemRisco[riscoB] - ordemRisco[riscoA];
                case 'frequencia':
                    // Ordenar por número de acontecimentos (se disponível)
                    return 0; // Implementar se tiver dados
                default:
                    return 0;
            }
        });
        
        // Reordenar os cards no container
        cardsArray.forEach(card => {
            container.appendChild(card);
        });
    });
});
</script>
{% endblock %}