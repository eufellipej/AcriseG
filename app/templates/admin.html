{% extends 'base.html' %}
{% load static %}

{% block extra_links %}
<title>Painel Administrativo - A Crise G</title>
<link rel="stylesheet" href="{% static 'styles/admin.css' %}">
{% endblock %}

{% block content %}
<div class="admin-wrapper">
    <!-- Sidebar -->
    <aside class="admin-sidebar">
        <div class="admin-logo">
            <div class="admin-logo-icon">
                <i class="fas fa-shield-alt"></i>
            </div>
            <div class="admin-logo-text">
                <h2>Painel Admin</h2>
                <p>A Crise G</p>
            </div>
        </div>

        <nav class="admin-nav">
            <div class="admin-nav-section">
                <h3>Principal</h3>
                <a href="?section=dashboard" class="admin-nav-item {% if active_section == 'dashboard' %}active{% endif %}">
                    <i class="fas fa-tachometer-alt"></i>
                    Dashboard
                </a>
                <a href="?section=analytics" class="admin-nav-item {% if active_section == 'analytics' %}active{% endif %}">
                    <i class="fas fa-chart-line"></i>
                    Análises
                </a>
            </div>

            <div class="admin-nav-section">
                <h3>Gerenciamento</h3>
                <a href="?section=users" class="admin-nav-item {% if active_section == 'users' %}active{% endif %}">
                    <i class="fas fa-users"></i>
                    Usuários
                    {% if total_usuarios > 0 %}
                    <span class="admin-nav-badge">{{ total_usuarios }}</span>
                    {% endif %}
                </a>
                <a href="?section=articles" class="admin-nav-item {% if active_section == 'articles' %}active{% endif %}">
                    <i class="fas fa-newspaper"></i>
                    Artigos
                    {% if total_artigos > 0 %}
                    <span class="admin-nav-badge">{{ total_artigos }}</span>
                    {% endif %}
                </a>
                <a href="?section=disasters" class="admin-nav-item {% if active_section == 'disasters' %}active{% endif %}">
                    <i class="fas fa-tornado"></i>
                    Desastres
                    {% if total_desastres > 0 %}
                    <span class="admin-nav-badge">{{ total_desastres }}</span>
                    {% endif %}
                </a>
                <a href="?section=games" class="admin-nav-item {% if active_section == 'games' %}active{% endif %}">
                    <i class="fas fa-gamepad"></i>
                    Jogos
                    {% if total_jogos > 0 %}
                    <span class="admin-nav-badge">{{ total_jogos }}</span>
                    {% endif %}
                </a>
            </div>

            <div class="admin-nav-section">
                <h3>Conteúdo</h3>
                <a href="?section=pages" class="admin-nav-item {% if active_section == 'pages' %}active{% endif %}">
                    <i class="fas fa-file-alt"></i>
                    Páginas
                </a>
                <a href="?section=faqs" class="admin-nav-item {% if active_section == 'faqs' %}active{% endif %}">
                    <i class="fas fa-question-circle"></i>
                    FAQs
                </a>
                <a href="?section=events" class="admin-nav-item {% if active_section == 'events' %}active{% endif %}">
                    <i class="fas fa-calendar-alt"></i>
                    Eventos
                </a>
            </div>

            <div class="admin-nav-section">
                <h3>Interações</h3>
                <a href="?section=questions" class="admin-nav-item {% if active_section == 'questions' %}active{% endif %}">
                    <i class="fas fa-comments"></i>
                    Perguntas
                    {% if perguntas_pendentes > 0 %}
                    <span class="admin-nav-badge">{{ perguntas_pendentes }}</span>
                    {% endif %}
                </a>
                <a href="?section=ratings" class="admin-nav-item {% if active_section == 'ratings' %}active{% endif %}">
                    <i class="fas fa-star"></i>
                    Avaliações
                    {% if avaliacoes_recentes > 0 %}
                    <span class="admin-nav-badge">{{ avaliacoes_recentes }}</span>
                    {% endif %}
                </a>
            </div>

            <div class="admin-nav-section">
                <h3>Sistema</h3>
                <a href="?section=settings" class="admin-nav-item {% if active_section == 'settings' %}active{% endif %}">
                    <i class="fas fa-cog"></i>
                    Configurações
                </a>
                <a href="?section=logs" class="admin-nav-item {% if active_section == 'logs' %}active{% endif %}">
                    <i class="fas fa-history"></i>
                    Logs
                </a>
            </div>
        </nav>
    </aside>

    <!-- Conteúdo Principal -->
    <main class="admin-content">
        <!-- Header -->
        <header class="admin-header">
            <div class="admin-header-left">
                <h1>
                    {% if active_section == 'dashboard' %}Dashboard
                    {% elif active_section == 'users' %}Usuários
                    {% elif active_section == 'articles' %}Artigos
                    {% elif active_section == 'disasters' %}Desastres
                    {% elif active_section == 'games' %}Jogos
                    {% elif active_section == 'questions' %}Perguntas
                    {% elif active_section == 'ratings' %}Avaliações
                    {% elif active_section == 'settings' %}Configurações
                    {% else %}Painel Administrativo{% endif %}
                </h1>
                <p>Gerencie todo o conteúdo do portal A Crise G</p>
            </div>

            <div class="admin-header-right">
                <button class="mobile-menu-toggle" id="mobileMenuToggle">
                    <i class="fas fa-bars"></i>
                </button>

                <div class="admin-search">
                    <i class="fas fa-search"></i>
                    <input type="text" placeholder="Buscar...">
                </div>

                <div class="admin-user-menu dropdown">
                    <button class="admin-user-btn dropdown-toggle" id="userDropdown">
                        <div class="admin-user-avatar">
                            {{ user_info.nome|slice:":1"|upper }}
                        </div>
                        <span>{{ user_info.nome }}</span>
                        <i class="fas fa-chevron-down"></i>
                    </button>
                    <div class="dropdown-menu" id="userDropdownMenu">
                        <a href="{% url 'usuario' %}" class="dropdown-item">
                            <i class="fas fa-user"></i>
                            Meu Perfil
                        </a>
                        <a href="{% url 'index' %}" class="dropdown-item">
                            <i class="fas fa-home"></i>
                            Voltar ao Site
                        </a>
                        <div class="dropdown-divider"></div>
                        <a href="{% url 'logout' %}" class="dropdown-item">
                            <i class="fas fa-sign-out-alt"></i>
                            Sair
                        </a>
                    </div>
                </div>
            </div>
        </header>

        <!-- Conteúdo Principal -->
        <div class="admin-main">
            {% if active_section == 'dashboard' %}
            <!-- Dashboard -->
            <div class="dashboard-grid">
                <div class="stat-card fade-in">
                    <div class="stat-card-header">
                        <div class="stat-card-icon users">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-card-change positive">
                            <i class="fas fa-arrow-up"></i>
                            {{ usuarios_recentes }} este mês
                        </div>
                    </div>
                    <div class="stat-card-title">Usuários Totais</div>
                    <div class="stat-card-value">{{ total_usuarios }}</div>
                </div>

                <div class="stat-card fade-in" style="animation-delay: 0.1s;">
                    <div class="stat-card-header">
                        <div class="stat-card-icon articles">
                            <i class="fas fa-newspaper"></i>
                        </div>
                        <div class="stat-card-change positive">
                            <i class="fas fa-arrow-up"></i>
                            12% este mês
                        </div>
                    </div>
                    <div class="stat-card-title">Artigos Publicados</div>
                    <div class="stat-card-value">{{ total_artigos }}</div>
                </div>

                <div class="stat-card fade-in" style="animation-delay: 0.2s;">
                    <div class="stat-card-header">
                        <div class="stat-card-icon disasters">
                            <i class="fas fa-tornado"></i>
                        </div>
                        <div class="stat-card-change positive">
                            <i class="fas fa-arrow-up"></i>
                            5% este mês
                        </div>
                    </div>
                    <div class="stat-card-title">Desastres Catalogados</div>
                    <div class="stat-card-value">{{ total_desastres }}</div>
                </div>

                <div class="stat-card fade-in" style="animation-delay: 0.3s;">
                    <div class="stat-card-header">
                        <div class="stat-card-icon questions">
                            <i class="fas fa-comments"></i>
                        </div>
                        <div class="stat-card-change negative">
                            <i class="fas fa-exclamation-circle"></i>
                            {{ perguntas_pendentes }} pendentes
                        </div>
                    </div>
                    <div class="stat-card-title">Perguntas</div>
                    <div class="stat-card-value">{{ perguntas_pendentes }}</div>
                </div>

                <div class="stat-card fade-in" style="animation-delay: 0.4s;">
                    <div class="stat-card-header">
                        <div class="stat-card-icon games">
                            <i class="fas fa-gamepad"></i>
                        </div>
                        <div class="stat-card-change positive">
                            <i class="fas fa-arrow-up"></i>
                            85% ativos
                        </div>
                    </div>
                    <div class="stat-card-title">Jogos Ativos</div>
                    <div class="stat-card-value">{{ total_jogos }}</div>
                </div>

                <div class="stat-card fade-in" style="animation-delay: 0.5s;">
                    <div class="stat-card-header">
                        <div class="stat-card-icon ratings">
                            <i class="fas fa-star"></i>
                        </div>
                        <div class="stat-card-change positive">
                            <i class="fas fa-arrow-up"></i>
                            {{ avaliacoes_recentes }} esta semana
                        </div>
                    </div>
                    <div class="stat-card-title">Avaliações</div>
                    <div class="stat-card-value">{{ avaliacoes_recentes }}</div>
                </div>
            </div>

            <!-- Gráficos -->
            <div class="charts-grid">
                <div class="chart-card">
                    <div class="chart-card-header">
                        <h3>Atividade de Usuários</h3>
                        <select class="filter-select">
                            <option>Últimos 7 dias</option>
                            <option>Últimos 30 dias</option>
                            <option>Últimos 90 dias</option>
                        </select>
                    </div>
                    <div class="chart-container">
                        <canvas id="usersChart"></canvas>
                    </div>
                </div>

                <div class="chart-card">
                    <div class="chart-card-header">
                        <h3>Distribuição de Usuários</h3>
                    </div>
                    <div class="chart-container">
                        <canvas id="distributionChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Últimas Atividades -->
            <div class="table-card">
                <div class="table-card-header">
                    <h3>Últimas Perguntas Pendentes</h3>
                    <div class="table-card-actions">
                        <button class="btn btn-primary" id="refreshQuestions">
                            <i class="fas fa-sync-alt"></i>
                            Atualizar
                        </button>
                    </div>
                </div>

                <div class="admin-filters">
                    <div class="filter-group">
                        <label for="filterStatus">Status</label>
                        <select id="filterStatus" class="filter-select">
                            <option value="all">Todos</option>
                            <option value="pending">Pendente</option>
                            <option value="answered">Respondida</option>
                            <option value="published">Publicada</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="filterGame">Jogo</label>
                        <select id="filterGame" class="filter-select">
                            <option value="all">Todos os Jogos</option>
                            {% for jogo in top_jogos %}
                            <option value="{{ jogo.id }}">{{ jogo.titulo }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>

                <table class="admin-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Usuário</th>
                            <th>Pergunta</th>
                            <th>Jogo</th>
                            <th>Data</th>
                            <th>Status</th>
                            <th>Ações</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for pergunta in ultimas_perguntas %}
                        <tr>
                            <td>#{{ pergunta.id }}</td>
                            <td>
                                {% if pergunta.usuario %}
                                {{ pergunta.usuario.nome }}
                                {% else %}
                                {{ pergunta.email }}
                                {% endif %}
                            </td>
                            <td>{{ pergunta.pergunta|truncatechars:50 }}</td>
                            <td>{{ pergunta.jogo.titulo }}</td>
                            <td>{{ pergunta.data_envio|date:"d/m/Y H:i" }}</td>
                            <td>
                                {% if pergunta.status == 'pendente' %}
                                <span class="badge badge-pending">Pendente</span>
                                {% elif pergunta.status == 'respondida' %}
                                <span class="badge badge-answered">Respondida</span>
                                {% elif pergunta.status == 'publicada' %}
                                <span class="badge badge-published">Publicada</span>
                                {% else %}
                                <span class="badge">{{ pergunta.status }}</span>
                                {% endif %}
                            </td>
                            <td>
                                <div class="action-buttons">
                                    <button class="btn-icon btn-view" data-id="{{ pergunta.id }}" data-action="view">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="btn-icon btn-approve" data-id="{{ pergunta.id }}" data-action="approve">
                                        <i class="fas fa-check"></i>
                                    </button>
                                    <button class="btn-icon btn-reject" data-id="{{ pergunta.id }}" data-action="reject">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="7" style="text-align: center; color: var(--admin-text-secondary);">
                                Nenhuma pergunta pendente no momento.
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>

                <div class="admin-pagination">
                    <button class="pagination-btn disabled">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <button class="pagination-btn active">1</button>
                    <button class="pagination-btn">2</button>
                    <button class="pagination-btn">3</button>
                    <button class="pagination-btn">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            </div>

            <!-- Últimos Usuários -->
            <div class="table-card">
                <div class="table-card-header">
                    <h3>Últimos Usuários Registrados</h3>
                    <button class="btn btn-primary" id="addUserBtn">
                        <i class="fas fa-plus"></i>
                        Adicionar Usuário
                    </button>
                </div>

                <table class="admin-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Nome</th>
                            <th>Email</th>
                            <th>Tipo</th>
                            <th>Data</th>
                            <th>Status</th>
                            <th>Ações</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for usuario in ultimos_usuarios %}
                        <tr>
                            <td>#{{ usuario.id }}</td>
                            <td>
                                <div style="display: flex; align-items: center; gap: 0.5rem;">
                                    {% if usuario.imagem %}
                                    <img src="{{ usuario.imagem }}" alt="{{ usuario.nome }}" style="width: 32px; height: 32px; border-radius: 50%;">
                                    {% else %}
                                    <div style="width: 32px; height: 32px; background: var(--admin-primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold;">
                                        {{ usuario.nome|slice:":1"|upper }}
                                    </div>
                                    {% endif %}
                                    {{ usuario.nome }}
                                </div>
                            </td>
                            <td>{{ usuario.email }}</td>
                            <td>
                                {% if usuario.tipo == 'admin' %}
                                <span class="badge badge-admin">Admin</span>
                                {% elif usuario.tipo == 'editor' %}
                                <span class="badge badge-editor">Editor</span>
                                {% else %}
                                <span class="badge badge-user">Usuário</span>
                                {% endif %}
                            </td>
                            <td>{{ usuario.data|date:"d/m/Y" }}</td>
                            <td>
                                {% if usuario.ativo %}
                                <span class="status-dot online"></span>
                                Ativo
                                {% else %}
                                <span class="status-dot offline"></span>
                                Inativo
                                {% endif %}
                            </td>
                            <td>
                                <div class="action-buttons">
                                    <button class="btn-icon btn-edit" data-id="{{ usuario.id }}" data-action="edit">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="btn-icon btn-delete" data-id="{{ usuario.id }}" data-action="delete">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="7" style="text-align: center; color: var(--admin-text-secondary);">
                                Nenhum usuário encontrado.
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>

            {% elif active_section == 'users' %}
            <!-- Gerenciamento de Usuários -->
            <div class="table-card">
                <div class="table-card-header">
                    <h3>Gerenciamento de Usuários</h3>
                    <div class="table-card-actions">
                        <button class="btn btn-primary" id="addUserBtn">
                            <i class="fas fa-plus"></i>
                            Novo Usuário
                        </button>
                        <button class="btn btn-secondary">
                            <i class="fas fa-download"></i>
                            Exportar
                        </button>
                    </div>
                </div>

                <div class="admin-filters">
                    <div class="filter-group">
                        <label for="filterUserType">Tipo</label>
                        <select id="filterUserType" class="filter-select">
                            <option value="all">Todos</option>
                            <option value="admin">Administradores</option>
                            <option value="editor">Editores</option>
                            <option value="usuario">Usuários</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="filterUserStatus">Status</label>
                        <select id="filterUserStatus" class="filter-select">
                            <option value="all">Todos</option>
                            <option value="active">Ativo</option>
                            <option value="inactive">Inativo</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="filterDate">Data</label>
                        <select id="filterDate" class="filter-select">
                            <option value="all">Todos os Tempos</option>
                            <option value="today">Hoje</option>
                            <option value="week">Esta Semana</option>
                            <option value="month">Este Mês</option>
                        </select>
                    </div>
                </div>

                <table class="admin-table">
                    <thead>
                        <tr>
                            <th><input type="checkbox" id="selectAllUsers"></th>
                            <th>ID</th>
                            <th>Nome</th>
                            <th>Email</th>
                            <th>Tipo</th>
                            <th>Data</th>
                            <th>Status</th>
                            <th>Ações</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for usuario in usuarios %}
                        <tr>
                            <td><input type="checkbox" class="user-checkbox" value="{{ usuario.id }}"></td>
                            <td>#{{ usuario.id }}</td>
                            <td>
                                <div style="display: flex; align-items: center; gap: 0.5rem;">
                                    {% if usuario.imagem %}
                                    <img src="{{ usuario.imagem }}" alt="{{ usuario.nome }}" style="width: 32px; height: 32px; border-radius: 50%;">
                                    {% else %}
                                    <div style="width: 32px; height: 32px; background: var(--admin-primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold;">
                                        {{ usuario.nome|slice:":1"|upper }}
                                    </div>
                                    {% endif %}
                                    {{ usuario.nome }}
                                </div>
                            </td>
                            <td>{{ usuario.email }}</td>
                            <td>
                                {% if usuario.tipo == 'admin' %}
                                <span class="badge badge-admin">Admin</span>
                                {% elif usuario.tipo == 'editor' %}
                                <span class="badge badge-editor">Editor</span>
                                {% else %}
                                <span class="badge badge-user">Usuário</span>
                                {% endif %}
                            </td>
                            <td>{{ usuario.data|date:"d/m/Y" }}</td>
                            <td>
                                {% if usuario.ativo %}
                                <span class="status-dot online"></span>
                                Ativo
                                {% else %}
                                <span class="status-dot offline"></span>
                                Inativo
                                {% endif %}
                            </td>
                            <td>
                                <div class="action-buttons">
                                    <button class="btn-icon btn-edit" data-id="{{ usuario.id }}" data-action="edit">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="btn-icon btn-view" data-id="{{ usuario.id }}" data-action="view">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="btn-icon btn-delete" data-id="{{ usuario.id }}" data-action="delete">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="8" style="text-align: center; color: var(--admin-text-secondary);">
                                Nenhum usuário encontrado.
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>

                <div class="admin-pagination">
                    <button class="pagination-btn disabled">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <button class="pagination-btn active">1</button>
                    <button class="pagination-btn">2</button>
                    <button class="pagination-btn">3</button>
                    <button class="pagination-btn">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            </div>

            {% elif active_section == 'articles' %}
            <!-- Gerenciamento de Artigos -->
            <div class="table-card">
                <div class="table-card-header">
                    <h3>Gerenciamento de Artigos</h3>
                    <div class="table-card-actions">
                        <button class="btn btn-primary" id="addArticleBtn">
                            <i class="fas fa-plus"></i>
                            Novo Artigo
                        </button>
                        <button class="btn btn-secondary">
                            <i class="fas fa-filter"></i>
                            Filtrar
                        </button>
                    </div>
                </div>

                <table class="admin-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Título</th>
                            <th>Autor</th>
                            <th>Data</th>
                            <th>Status</th>
                            <th>Visualizações</th>
                            <th>Ações</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for artigo in artigos %}
                        <tr>
                            <td>#{{ artigo.id }}</td>
                            <td>{{ artigo.titulo|truncatechars:50 }}</td>
                            <td>
                                {% if artigo.usuario %}
                                {{ artigo.usuario.nome }}
                                {% else %}
                                Sistema
                                {% endif %}
                            </td>
                            <td>{{ artigo.dataPublicacao|date:"d/m/Y" }}</td>
                            <td>
                                <span class="badge badge-published">Publicado</span>
                            </td>
                            <td>1,234</td>
                            <td>
                                <div class="action-buttons">
                                    <button class="btn-icon btn-edit" data-id="{{ artigo.id }}">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="btn-icon btn-view" data-id="{{ artigo.id }}">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="btn-icon btn-delete" data-id="{{ artigo.id }}">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="7" style="text-align: center; color: var(--admin-text-secondary);">
                                Nenhum artigo encontrado.
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>

            {% elif active_section == 'disasters' %}
            <!-- Gerenciamento de Desastres -->
            <div class="table-card">
                <div class="table-card-header">
                    <h3>Tipos de Desastres</h3>
                    <div class="table-card-actions">
                        <button class="btn btn-primary" id="addDisasterBtn">
                            <i class="fas fa-plus"></i>
                            Novo Desastre
                        </button>
                    </div>
                </div>

                <table class="admin-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Título</th>
                            <th>Descrição</th>
                            <th>Ícone</th>
                            <th>Artigos</th>
                            <th>Ações</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for desastre in desastres %}
                        <tr>
                            <td>#{{ desastre.id }}</td>
                            <td>{{ desastre.titulo }}</td>
                            <td>{{ desastre.descricao|truncatechars:50 }}</td>
                            <td>
                                {% if desastre.icone %}
                                <i class="{{ desastre.icone }}"></i>
                                {% else %}
                                <i class="fas fa-tornado"></i>
                                {% endif %}
                            </td>
                            <td>{{ desastre.artigo_set.count }}</td>
                            <td>
                                <div class="action-buttons">
                                    <button class="btn-icon btn-edit" data-id="{{ desastre.id }}">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="btn-icon btn-view" data-id="{{ desastre.id }}">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="btn-icon btn-delete" data-id="{{ desastre.id }}">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="6" style="text-align: center; color: var(--admin-text-secondary);">
                                Nenhum desastre encontrado.
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>

            {% elif active_section == 'games' %}
            <!-- Gerenciamento de Jogos -->
            <div class="table-card">
                <div class="table-card-header">
                    <h3>Jogos Educativos</h3>
                    <div class="table-card-actions">
                        <button class="btn btn-primary" id="addGameBtn">
                            <i class="fas fa-plus"></i>
                            Novo Jogo
                        </button>
                    </div>
                </div>

                <div class="admin-filters">
                    <div class="filter-group">
                        <label for="filterGameStatus">Status</label>
                        <select id="filterGameStatus" class="filter-select">
                            <option value="all">Todos</option>
                            <option value="active">Ativo</option>
                            <option value="inactive">Inativo</option>
                        </select>
                    </div>
                </div>

                <table class="admin-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Título</th>
                            <th>Versão</th>
                            <th>Desenvolvedor</th>
                            <th>Jogadores</th>
                            <th>Avaliação</th>
                            <th>Status</th>
                            <th>Ações</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for jogo in jogos %}
                        <tr>
                            <td>#{{ jogo.id }}</td>
                            <td>
                                <div style="display: flex; align-items: center; gap: 0.5rem;">
                                    {% if jogo.imagem_capa %}
                                    <img src="{{ jogo.imagem_capa }}" alt="{{ jogo.titulo }}" style="width: 40px; height: 40px; border-radius: 8px; object-fit: cover;">
                                    {% endif %}
                                    {{ jogo.titulo }}
                                </div>
                            </td>
                            <td>{{ jogo.versao }}</td>
                            <td>{{ jogo.desenvolvedor }}</td>
                            <td>{{ jogo.jogadores_ativos|floatformat:0 }}</td>
                            <td>
                                <div style="display: flex; align-items: center; gap: 0.25rem;">
                                    <i class="fas fa-star" style="color: #f39c12;"></i>
                                    {{ jogo.avaliacao_media }}
                                </div>
                            </td>
                            <td>
                                {% if jogo.ativo %}
                                <span class="badge badge-published">Ativo</span>
                                {% else %}
                                <span class="badge badge-pending">Inativo</span>
                                {% endif %}
                            </td>
                            <td>
                                <div class="action-buttons">
                                    <button class="btn-icon btn-edit" data-id="{{ jogo.id }}">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="btn-icon btn-view" data-id="{{ jogo.id }}">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <a href="{% url 'jogo' %}" class="btn-icon btn-view" title="Ver no site">
                                        <i class="fas fa-external-link-alt"></i>
                                    </a>
                                </div>
                            </td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="8" style="text-align: center; color: var(--admin-text-secondary);">
                                Nenhum jogo encontrado.
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>

            {% elif active_section == 'questions' %}
            <!-- Gerenciamento de Perguntas -->
            <div class="table-card">
                <div class="table-card-header">
                    <h3>Perguntas dos Usuários</h3>
                    <div class="table-card-actions">
                        <button class="btn btn-primary" id="refreshQuestions">
                            <i class="fas fa-sync-alt"></i>
                            Atualizar
                        </button>
                        <button class="btn btn-secondary" id="exportQuestions">
                            <i class="fas fa-download"></i>
                            Exportar
                        </button>
                    </div>
                </div>

                <div class="admin-filters">
                    <div class="filter-group">
                        <label for="filterQuestionStatus">Status</label>
                        <select id="filterQuestionStatus" class="filter-select">
                            <option value="all">Todos</option>
                            <option value="pending">Pendente</option>
                            <option value="answered">Respondida</option>
                            <option value="published">Publicada</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="filterQuestionGame">Jogo</label>
                        <select id="filterQuestionGame" class="filter-select">
                            <option value="all">Todos os Jogos</option>
                            {% for jogo in jogos %}
                            <option value="{{ jogo.id }}">{{ jogo.titulo }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>

                <table class="admin-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Usuário</th>
                            <th>Pergunta</th>
                            <th>Jogo</th>
                            <th>Data</th>
                            <th>Status</th>
                            <th>Tempo</th>
                            <th>Ações</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for pergunta in perguntas %}
                        <tr>
                            <td>#{{ pergunta.id }}</td>
                            <td>
                                {% if pergunta.usuario %}
                                {{ pergunta.usuario.nome }}
                                {% else %}
                                {{ pergunta.email }}
                                {% endif %}
                            </td>
                            <td>{{ pergunta.pergunta|truncatechars:80 }}</td>
                            <td>{{ pergunta.jogo.titulo }}</td>
                            <td>{{ pergunta.data_envio|date:"d/m/Y H:i" }}</td>
                            <td>
                                {% if pergunta.status == 'pendente' %}
                                <span class="badge badge-pending">Pendente</span>
                                {% elif pergunta.status == 'respondida' %}
                                <span class="badge badge-answered">Respondida</span>
                                {% elif pergunta.status == 'publicada' %}
                                <span class="badge badge-published">Publicada</span>
                                {% else %}
                                <span class="badge">{{ pergunta.status }}</span>
                                {% endif %}
                            </td>
                            <td>{{ pergunta.tempo_decorrido }}</td>
                            <td>
                                <div class="action-buttons">
                                    <button class="btn-icon btn-view" data-id="{{ pergunta.id }}" data-action="view">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="btn-icon btn-approve" data-id="{{ pergunta.id }}" data-action="approve">
                                        <i class="fas fa-check"></i>
                                    </button>
                                    <button class="btn-icon btn-reject" data-id="{{ pergunta.id }}" data-action="reject">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="8" style="text-align: center; color: var(--admin-text-secondary);">
                                Nenhuma pergunta encontrada.
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>

            {% elif active_section == 'ratings' %}
            <!-- Avaliações -->
            <div class="table-card">
                <div class="table-card-header">
                    <h3>Avaliações dos Usuários</h3>
                    <div class="table-card-actions">
                        <button class="btn btn-primary" id="refreshRatings">
                            <i class="fas fa-sync-alt"></i>
                            Atualizar
                        </button>
                    </div>
                </div>

                <div class="admin-filters">
                    <div class="filter-group">
                        <label for="filterRatingGame">Jogo</label>
                        <select id="filterRatingGame" class="filter-select">
                            <option value="all">Todos os Jogos</option>
                            {% for jogo in jogos %}
                            <option value="{{ jogo.id }}">{{ jogo.titulo }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="filterRating">Avaliação</label>
                        <select id="filterRating" class="filter-select">
                            <option value="all">Todas</option>
                            <option value="5">5 Estrelas</option>
                            <option value="4">4 Estrelas</option>
                            <option value="3">3 Estrelas</option>
                            <option value="2">2 Estrelas</option>
                            <option value="1">1 Estrela</option>
                        </select>
                    </div>
                </div>

                <table class="admin-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Usuário</th>
                            <th>Jogo</th>
                            <th>Avaliação</th>
                            <th>Comentário</th>
                            <th>Data</th>
                            <th>Ações</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for avaliacao in avaliacoes %}
                        <tr>
                            <td>#{{ avaliacao.id }}</td>
                            <td>{{ avaliacao.usuario.nome }}</td>
                            <td>{{ avaliacao.jogo.titulo }}</td>
                            <td>
                                <div style="display: flex; align-items: center; gap: 0.25rem;">
                                    {% for i in "12345" %}
                                        {% if forloop.counter <= avaliacao.nota %}
                                            <i class="fas fa-star" style="color: #f39c12;"></i>
                                        {% else %}
                                            <i class="far fa-star" style="color: #ccc;"></i>
                                        {% endif %}
                                    {% endfor %}
                                    <span>({{ avaliacao.nota }})</span>
                                </div>
                            </td>
                            <td>{{ avaliacao.texto|truncatechars:50 }}</td>
                            <td>{{ avaliacao.horario|date:"d/m/Y H:i" }}</td>
                            <td>
                                <div class="action-buttons">
                                    <button class="btn-icon btn-view" data-id="{{ avaliacao.id }}">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="btn-icon btn-delete" data-id="{{ avaliacao.id }}">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="7" style="text-align: center; color: var(--admin-text-secondary);">
                                Nenhuma avaliação encontrada.
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>

            {% elif active_section == 'settings' %}
            <!-- Configurações -->
            <div class="table-card">
                <div class="table-card-header">
                    <h3>Configurações do Sistema</h3>
                </div>

                <form id="settingsForm">
                    <div class="form-group">
                        <label for="siteName">Nome do Site</label>
                        <input type="text" id="siteName" class="form-control" value="A Crise G" required>
                    </div>

                    <div class="form-group">
                        <label for="siteDescription">Descrição</label>
                        <textarea id="siteDescription" class="form-control" rows="3">Portal educativo sobre prevenção de desastres naturais</textarea>
                    </div>

                    <div class="form-group">
                        <label for="siteEmail">Email de Contato</label>
                        <input type="email" id="siteEmail" class="form-control" value="contato@acriseg.org" required>
                    </div>

                    <div class="form-group">
                        <label for="maintenanceMode">Modo Manutenção</label>
                        <select id="maintenanceMode" class="form-control">
                            <option value="false">Desativado</option>
                            <option value="true">Ativado</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="allowRegistrations">Permitir Registros</label>
                        <select id="allowRegistrations" class="form-control">
                            <option value="true">Sim</option>
                            <option value="false">Não</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="notificationEmail">Email para Notificações</label>
                        <input type="email" id="notificationEmail" class="form-control" value="notificacoes@acriseg.org">
                    </div>

                    <div class="form-group">
                        <label for="maxUploadSize">Tamanho Máximo de Upload (MB)</label>
                        <input type="number" id="maxUploadSize" class="form-control" value="10" min="1" max="100">
                    </div>

                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i>
                        Salvar Configurações
                    </button>
                </form>
            </div>

            {% elif active_section == 'logs' %}
            <!-- Logs do Sistema -->
            <div class="table-card">
                <div class="table-card-header">
                    <h3>Logs do Sistema</h3>
                    <div class="table-card-actions">
                        <button class="btn btn-primary" id="refreshLogs">
                            <i class="fas fa-sync-alt"></i>
                            Atualizar
                        </button>
                        <button class="btn btn-danger" id="clearLogs">
                            <i class="fas fa-trash"></i>
                            Limpar Logs
                        </button>
                    </div>
                </div>

                <div class="admin-filters">
                    <div class="filter-group">
                        <label for="filterLogType">Tipo</label>
                        <select id="filterLogType" class="filter-select">
                            <option value="all">Todos</option>
                            <option value="info">Informação</option>
                            <option value="warning">Aviso</option>
                            <option value="error">Erro</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="filterLogDate">Data</label>
                        <select id="filterLogDate" class="filter-select">
                            <option value="all">Todas</option>
                            <option value="today">Hoje</option>
                            <option value="week">Esta Semana</option>
                            <option value="month">Este Mês</option>
                        </select>
                    </div>
                </div>

                <div class="logs-container" style="max-height: 600px; overflow-y: auto;">
                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th>Data/Hora</th>
                                <th>Tipo</th>
                                <th>Módulo</th>
                                <th>Mensagem</th>
                                <th>Usuário</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>10/12/2024 14:30</td>
                                <td><span class="badge badge-info">Info</span></td>
                                <td>Autenticação</td>
                                <td>Usuário admin fez login</td>
                                <td>admin@acriseg.org</td>
                            </tr>
                            <tr>
                                <td>10/12/2024 14:25</td>
                                <td><span class="badge badge-warning">Aviso</span></td>
                                <td>Banco de Dados</td>
                                <td>Consulta demorando mais que o esperado</td>
                                <td>Sistema</td>
                            </tr>
                            <tr>
                                <td>10/12/2024 14:20</td>
                                <td><span class="badge badge-error">Erro</span></td>
                                <td>API</td>
                                <td>Falha na conexão com serviço externo</td>
                                <td>Sistema</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            {% else %}
            <!-- Conteúdo Padrão -->
            <div class="empty-message">
                <i class="fas fa-tachometer-alt"></i>
                <h3>Selecione uma seção no menu lateral</h3>
                <p>Use o menu lateral para navegar entre as diferentes seções do painel administrativo.</p>
            </div>
            {% endif %}
        </div>
    </main>
</div>

<!-- Modals -->
<!-- Modal Editar Usuário -->
<div class="admin-modal" id="editUserModal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Editar Usuário</h3>
            <button class="modal-close">&times;</button>
        </div>
        <div class="modal-body">
            <form id="editUserForm">
                <div class="form-group">
                    <label for="editUserName">Nome</label>
                    <input type="text" id="editUserName" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="editUserEmail">Email</label>
                    <input type="email" id="editUserEmail" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="editUserType">Tipo</label>
                    <select id="editUserType" class="form-control">
                        <option value="usuario">Usuário</option>
                        <option value="editor">Editor</option>
                        <option value="admin">Administrador</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="editUserStatus">Status</label>
                    <select id="editUserStatus" class="form-control">
                        <option value="active">Ativo</option>
                        <option value="inactive">Inativo</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="editUserPassword">Nova Senha (opcional)</label>
                    <input type="password" id="editUserPassword" class="form-control">
                    <small>Deixe em branco para manter a senha atual</small>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" id="cancelEdit">Cancelar</button>
            <button class="btn btn-primary" id="saveUser">Salvar</button>
        </div>
    </div>
</div>

<!-- Modal Visualizar Pergunta -->
<div class="admin-modal" id="viewQuestionModal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Detalhes da Pergunta</h3>
            <button class="modal-close">&times;</button>
        </div>
        <div class="modal-body">
            <div class="detail-item">
                <strong>Usuário:</strong>
                <span id="questionUser">Carregando...</span>
            </div>
            <div class="detail-item">
                <strong>Email:</strong>
                <span id="questionEmail">Carregando...</span>
            </div>
            <div class="detail-item">
                <strong>Jogo:</strong>
                <span id="questionGame">Carregando...</span>
            </div>
            <div class="detail-item">
                <strong>Data:</strong>
                <span id="questionDate">Carregando...</span>
            </div>
            <div class="detail-item">
                <strong>Pergunta:</strong>
                <p id="questionText" style="white-space: pre-wrap; background: var(--admin-bg); padding: 1rem; border-radius: 8px; margin-top: 0.5rem;"></p>
            </div>
            <div class="form-group">
                <label for="questionResponse">Resposta</label>
                <textarea id="questionResponse" class="form-control form-textarea" placeholder="Digite a resposta aqui..."></textarea>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" id="cancelView">Cancelar</button>
            <button class="btn btn-primary" id="sendResponse">Enviar Resposta</button>
        </div>
    </div>
</div>

<!-- Modal de Confirmação -->
<div class="admin-modal" id="confirmModal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 id="confirmTitle">Confirmar Ação</h3>
            <button class="modal-close">&times;</button>
        </div>
        <div class="modal-body">
            <p id="confirmMessage">Tem certeza que deseja realizar esta ação?</p>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" id="confirmCancel">Cancelar</button>
            <button class="btn btn-danger" id="confirmAction">Confirmar</button>
        </div>
    </div>
</div>

<!-- Container para Notificações -->
<div id="notificationsContainer"></div>

{% endblock %}

{% block extra_scripts %}
<script src="{% static 'scripts/admin.js' %}"></script>
{% endblock %}